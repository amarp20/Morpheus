{% extends 'base.html' %}
{% block title %}Actualizar Estado de Cama{% endblock %}

{% block content %}
<section class="container">
  <h1>Actualizar Estado de una Cama</h1>

  <div class="card">
    <label for="bedSelect">Elige una cama:</label>
    <select id="bedSelect">
      <option value="">-- Selecciona --</option>
    </select>
  </div>

  <div class="card">
    <button id="markOccupied">Marcar Ocupada</button>
    <button id="markFree">Marcar Desocupada</button>
  </div>

  <div id="updateMessage" class="card message"></div>
</section>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const bedSelect = document.getElementById('bedSelect');
  const msg = document.getElementById('updateMessage');

  // 1) Cargar todas las camas para el <select>
  fetch('/api/search-beds')
    .then(r => r.json())
    .then(({beds}) => {
      beds.forEach(b => {
        const opt = document.createElement('option');
        opt.value = b.bed_id;
        opt.textContent = `${b.bed_id} — ${b.estado}`;
        bedSelect.appendChild(opt);
      });
    });

  // 2) Función de actualización
  function updateBed(newState) {
    const bedId = bedSelect.value;
    if (!bedId) {
      alert('Primero selecciona una cama');
      return;
    }
    fetch(`/api/update-bed/${bedId}`, {
      method: 'PUT',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({estado: newState})
    })
    .then(r => r.json())
    .then(res => {
      msg.innerText = res.message;
      // refrescar la opción mostrada
      const selOpt = bedSelect.selectedOptions[0];
      selOpt.textContent = `${bedId} — ${newState}`;
    })
    .catch(_ => {
      msg.innerText = 'Error al actualizar.';
    });
  }

  document.getElementById('markOccupied')
    .addEventListener('click', () => updateBed('Ocupada'));

  document.getElementById('markFree')
    .addEventListener('click', () => updateBed('Desocupada'));
});
</script>
{% endblock %}
