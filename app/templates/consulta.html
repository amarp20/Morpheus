{% extends 'base.html' %}
{% block title %}Consultar Disponibilidad{% endblock %}
{% block content %}
  <main>
    <section class="controls">
      <h2>Consultar Disponibilidad</h2>
      <div class="select-row">
        <form method="get" action="{{ url_for('main.consulta') }}">
          <div class="select-group">
            <label for="planta">Planta</label>
            <select id="planta" name="planta" onchange="this.form.submit()">
              <option value="">Planta</option>
              {% for p in plantas %}
                <option value="{{ p }}" {% if planta == p %}selected{% endif %}>{{ p }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="select-group">
            <label for="zona">Zona</label>
            <select id="zona" name="zona" onchange="this.form.submit()" {% if not zonas %}disabled{% endif %}>
              <option value="">Zona</option>
              {% for z in zonas %}
                <option value="{{ z }}" {% if zona == z %}selected{% endif %}>{{ z }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="select-group">
            <label for="modulo">Módulo</label>
            <select id="modulo" name="modulo" onchange="this.form.submit()" {% if not modulos %}disabled{% endif %}>
              <option value="">Módulo</option>
              {% for m in modulos %}
                <option value="{{ m }}" {% if modulo == m %}selected{% endif %}>{{ m }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="select-group">
            <label for="habitacion">Habitación</label>
            <select id="habitacion" name="habitacion" onchange="this.form.submit()" {% if not habitaciones %}disabled{% endif %}>
              <option value="">Habitación</option>
              {% for h in habitaciones %}
                <option value="{{ h }}" {% if habitacion == h %}selected{% endif %}>{{ h }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="select-group">
            <label for="genero">Género</label>
            <select id="genero" name="genero" onchange="this.form.submit()">
              <option value="">Género</option>
              {% for g in generos %}
                <option value="{{ g }}" {% if genero == g %}selected{% endif %}>{{ g }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="select-group">
            <label for="numero_alumno">Nº Alumno</label>
            <select id="numero_alumno" name="numero_alumno" onchange="this.form.submit()">
              <option value="">Nº Alumno</option>
              {% for n in numeros_alumno %}
                <option value="{{ n }}" {% if numero_alumno == n %}selected{% endif %}>{{ n }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit" name="consultar" value="1">Consultar</button>
        </form>
      </div>
      {% if camas %}
        <button type="button" onclick="window.print()" class="btn btn-primary print-allowed" style="margin: 1em 0;">Imprimir</button>
        <ul id="bed-list">
          {% for cama in camas %}
            <li>
              Planta {{ cama.planta }}, Zona {{ cama.zona }}, Módulo {{ cama.modulo }}, Hab. {{ cama.habitacion }}, 
              Cama {{ cama.bed_id }}, Estado {{ cama.estado }},
              {% if cama.genero %}Género: {{ cama.genero }},{% endif %}
              {% if cama.estado == "Ocupada" %}
                Alumno: {{ cama.nombre_alumno }}, Nº Alumno: {{ cama.numero_alumno }}
                <form method="post" action="{{ url_for('main.desocupar_cama') }}" style="display:inline;">
                  <input type="hidden" name="bed_id" value="{{ cama.bed_id }}">
                  <button type="submit" class="btn btn-warning btn-sm">Desocupar</button>
                </form>
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <ul id="bed-list">
          <li>No hay camas</li>
        </ul>
      {% endif %}
    </section>
  </main>
{% endblock %}
